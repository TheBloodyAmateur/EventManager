name: Generate Release Notes with Changelog Action

on:
  push:
    branches:
      - main

jobs:
  generate_release_notes:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Generate Changelog
        id: generate_notes
        uses: requarks/changelog-action@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fromTag: "v${{ env.PREV_TAG }}"
          toTag: "v${{ github.run_number }}"
          categories: |
            feat: 🚀 Features
            fix: 🐛 Bug Fixes
            docs: 📖 Documentation
            chore: 🛠️ Chores
            refactor: 🔄 Refactors
          template: |
            ## Changes in v${{ github.run_number }}
            {{CATEGORIES}}

      - name: Echo Generated Changelog
        run: echo "Generated Changelog:\n${{ steps.generate_notes.outputs.changelog }}"
